webpackJsonp([5],{FJq9:function(e,t){},PqCh:function(e,t){},S3LB:function(e,t){},aw6s:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("woOf"),r=a.n(s),o=a("wbDJ"),i=a("2ay1"),l=a("eMo/"),n=a("Nqf6"),c=a("jsdL"),f={name:"form",components:{TreeDialog:n.a,Fileupload:l.a},data:function(){return{title:"",dialogVisible:!1,showFooter:!0,form:{},oldUsername:"",rules:{officeName:[{required:!0,message:"请输入所属机构",trigger:"blur"}],username:[{required:!0,message:"请输入登录名",trigger:"blur"},{validator:this.validateUsername,trigger:"blur"}],confirmPassword:[{validator:this.validatePassword,trigger:"blur"}],no:[{required:!0,message:"请输入工号",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],loginFlag:[{required:!0,message:"请输入是否可登录",trigger:"blur"}]}}},methods:{validatePassword:function(e,t,a){""!=this.form.password&&t!==this.form.password?a(new Error("两次输入密码不一致!")):a()},validateUsername:function(e,t,a){this.oldUsername!==t?Object(o.f)("sys/user/findByUsername",{username:t}).then(function(e){e.code===c.a.success&&(e.data&&e.data.id?a(new Error("用户名已经存在，请更换用户名")):a())}).catch(function(){a(new Error("服务错误，校验失败"))}):a()},showTree:function(){this.$refs.treeDialog.showDialog("选择组织机构")},treeConfirm:function(e){this.$set(this.form,"officeId",e.data.id),this.$set(this.form,"officeName",e.data.name)},confirmInfo:function(){Object(o.h)(this,"form","sys/user/save",this.form)},hasBtnPermission:function(e){return Object(i.b)(e)},showDialog:function(e,t,a,s){this.title=e,this.dialogVisible=t,this.form=r()({},a),this.oldUsername=this.form.username?this.form.username:"",this.showFooter=!s||0===s;var o=this;setTimeout(function(){o.$refs.fileupload.initUpload(o.form.photo,{categoryId:"userheader",categoryName:"用户头像"})},10)},closeFormDialog:function(){this.$refs.form.resetFields(),this.form={}}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.title,visible:e.dialogVisible,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.closeFormDialog}},[s("div",{staticClass:"form-wrapper"},[s("el-form",{ref:"form",class:!1===e.showFooter?"view":"",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{staticStyle:{height:"60px"},attrs:{label:"头像:",prop:"photo"}},[s("fileupload",{ref:"fileupload",attrs:{value:e.form.photo,"default-img":a("6vfR")},on:{"update:value":function(t){return e.$set(e.form,"photo",t)}}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"归属部门:",prop:"officeName"}},[s("el-input",{attrs:{readonly:""},nativeOn:{click:function(t){return e.showTree()}},model:{value:e.form.officeName,callback:function(t){e.$set(e.form,"officeName",t)},expression:"form.officeName"}}),e._v(" "),s("tree-dialog",{ref:"treeDialog",attrs:{loadUrl:"sys/sysOffice/loadList",rootParams:{},lazy:!1},on:{treeConfirm:e.treeConfirm}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"工号:",prop:"no"}},[s("el-input",{model:{value:e.form.no,callback:function(t){e.$set(e.form,"no",t)},expression:"form.no"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"登录名:",prop:"username"}},[s("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"姓名:",prop:"name"}},[s("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"密码:",prop:"password"}},[s("el-input",{attrs:{type:"password",placeholder:"不修改密码请留空"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{type:"password",label:"确认密码:",prop:"confirmPassword"}},[s("el-input",{model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"是否可登录:",prop:"loginFlag"}},[s("el-radio-group",{model:{value:e.form.loginFlag,callback:function(t){e.$set(e.form,"loginFlag",t)},expression:"form.loginFlag"}},[s("el-radio",{attrs:{label:"1"}},[e._v("启用")]),e._v(" "),s("el-radio",{attrs:{label:"0"}},[e._v("禁用")])],1)],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"邮箱:",prop:"email"}},[s("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"手机:",prop:"mobile"}},[s("el-input",{model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"最后登陆IP:"}},[e._v("\n                "+e._s(e.form.loginIp)+"\n              ")])],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"最后登陆时间:"}},[e._v("\n                "+e._s(e.form.loginDate)+"\n              ")])],1)],1)],1)],1),e._v(" "),e.showFooter?s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.confirmInfo()}}},[e._v("确 定")])],1):e._e()])},staticRenderFns:[]};var p=a("VU/8")(f,u,!1,function(e){a("FJq9")},"data-v-9a34f9f8",null).exports,m=a("vgQg"),d=a("KvKp"),g={name:"list",components:{formInfo:p},data:function(){return{tableData:[],office_data:[],office_props:{children:"children",label:"name"},params:{page:{totalRecord:0,pageSize:m.a.pageSize?m.a.pageSize:20,page:1}},currentOffice:{}}},methods:{officeClick:function(e){var t=this;this.params.officeId=e.id,this.currentOffice=e,this.loadList(),this.$nextTick(function(){t.$refs.officeTree.setCurrentKey(value)})},getUserfiles:function(e){return Object(d.e)(e)},handlePageChange:function(e){this.loadList()},hasBtnPermission:function(e){return Object(i.b)(e)},loadList:function(){Object(o.e)(this,"sys/user/loadList",this.params)},loadOfficeList:function(){var e=this;this.params.officeId="",this.currentOffice={},Object(o.e)(this,"sys/sysOffice/loadList",{},function(t){t.code===c.a.success&&(e.office_data=Object(d.i)(t.data,{id:"id",pid:"parentId"}))},".panel-content"),this.loadList()},edit:function(e,t){var a=(t?"查看":e&&e.id?"编辑":"新增")+"用户表";this.$refs.formInfo.showDialog(a,!0,e||{loginFlag:"1",parentId:this.currentOffice.id,parentName:this.currentOffice.name},t?1:0)},deleteInfo:function(e){Object(o.d)(this,"sys/user/delete",e)},updateData:function(e){this.loadList()},dbclick:function(e,t,a){var s=!0;this.hasBtnPermission("edit:sys:sysUser")&&(s=!1),this.edit(e,s)}},mounted:function(){this.loadList(),this.loadOfficeList()}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-wrapper"},[s("el-row",[s("el-col",{attrs:{span:4}},[s("div",{staticClass:"panel-header"},[s("div",{staticClass:"title"},[e._v("组织机构")]),e._v(" "),s("div",{staticClass:"oper"},[s("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-refresh",circle:""},nativeOn:{click:function(t){return e.loadOfficeList()}}})],1)]),e._v(" "),s("div",{staticClass:"panel-content"},[s("el-tree",{ref:"officeTree",attrs:{data:e.office_data,props:e.office_props},on:{"node-click":e.officeClick}})],1)]),e._v(" "),s("el-col",{attrs:{span:20}},[s("div",{staticClass:"params-wrapper"},[s("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.params},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"关键值:"}},[s("el-input",{attrs:{placeholder:"关键值查询"},model:{value:e.params.keyName,callback:function(t){e.$set(e.params,"keyName",t)},expression:"params.keyName"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary","native-type":"submit"},on:{click:function(t){return e.loadList()}}},[s("i",{staticClass:"el-icon-search"}),e._v(" 查询")])],1),e._v(" "),s("div",{staticClass:"oper-wrapper"},[e.hasBtnPermission("edit:sys:sysUser")?s("el-button",{attrs:{type:"success",title:"新增"},on:{click:function(t){return e.edit()}}},[s("i",{staticClass:"el-icon-plus"}),e._v(" 新增")]):e._e()],1)],1)],1),e._v(" "),s("div",{staticClass:"table-wrapper"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:"calc(100% - 40px)"},on:{"row-dblclick":e.dbclick}},[s("el-table-column",{attrs:{label:"序号",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s((e.params.page.page-1)*e.params.page.pageSize+t.$index+1)+"\n            ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"photo",label:"用户头像",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.photo&&""!=t.row.photo?s("img",{staticClass:"head-img",attrs:{src:e.getUserfiles(t.row.photo)}}):s("img",{staticClass:"head-img",attrs:{src:a("6vfR")}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"officeName",label:"所属机构"}}),e._v(" "),s("el-table-column",{attrs:{prop:"no",label:"工号"}}),e._v(" "),s("el-table-column",{attrs:{prop:"username",label:"登录名"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),s("el-table-column",{attrs:{prop:"mobile",label:"手机"}}),e._v(" "),s("el-table-column",{attrs:{prop:"loginFlag",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s("1"==t.row.loginFlag?"激活":"禁用")+"\n            ")]}}])}),e._v(" "),s("el-table-column",{attrs:{fixed:"right",width:"150",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasBtnPermission("edit:sys:sysUser")?s("el-button",{attrs:{type:"primary",title:"编辑",icon:"el-icon-edit",circle:""},on:{click:function(a){return e.edit(t.row)}}}):e.hasBtnPermission("view:sys:sysUser")?s("el-button",{attrs:{type:"success",title:"查看",icon:"el-icon-search",circle:""},on:{click:function(a){return e.edit(t.row,!0)}}}):e._e(),e._v(" "),"u_01"!=t.row.id&&e.hasBtnPermission("del:sys:sysUser")?s("el-button",{attrs:{type:"danger",title:"删除",icon:"el-icon-delete",circle:""},on:{click:function(a){return e.deleteInfo(t.row)}}}):e._e()]}}])})],1),e._v(" "),s("el-pagination",{attrs:{"current-page":e.params.page.page,"page-sizes":[10,20,30,50,100],"page-size":e.params.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.params.page.totalRecord},on:{"size-change":e.handlePageChange,"current-change":e.handlePageChange,"update:currentPage":function(t){return e.$set(e.params.page,"page",t)},"update:current-page":function(t){return e.$set(e.params.page,"page",t)},"update:pageSize":function(t){return e.$set(e.params.page,"pageSize",t)},"update:page-size":function(t){return e.$set(e.params.page,"pageSize",t)}}})],1)])],1),e._v(" "),s("form-info",{ref:"formInfo",on:{updateData:e.updateData}})],1)},staticRenderFns:[]};var v=a("VU/8")(g,h,!1,function(e){a("PqCh")},"data-v-1de56734",null);t.default=v.exports},"eMo/":function(e,t,a){"use strict";var s=a("KvKp"),r=a("jsdL"),o={name:"fileupload",props:{defaultImg:{type:String,default:function(){return""}},cssClass:{type:String,default:function(){return""}},cssStyle:{type:String,default:function(){return""}},uploadType:{type:String,default:function(){return""}}},data:function(){return{params:{},value:"",uploadPath:Object(s.c)(window._BASE_URL+window._ADMIN_URL+"/uploadFile/upload"),fileUrl:Object(s.c)(window._BASE_URL+"/userfiles/"+this.value)}},methods:{initUpload:function(e,t){this.value=e,this.params=t,this.fileUrl=Object(s.c)(window._BASE_URL+"/userfiles/"+this.value)},uploadSuccess:function(e,t,a){console.log("upload",e),e.code===r.a.success&&(this.fileUrl=Object(s.c)(window._BASE_URL+"/userfiles/"+e.data.realName),this.value=e.data.realName,this.$emit("update:value",e.data.realName))},uploadError:function(e,t,a){this.$message.error(t.name+"上传失败")},beforeUpload:function(e){return!0}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadPath,data:e.params,accept:e.uploadType,"show-file-list":!1,"on-success":e.uploadSuccess,"on-error":e.uploadError,"before-upload":e.beforeUpload}},[e.value?a("img",{staticClass:"avatar",class:e.cssClass,style:e.cssStyle,attrs:{src:e.fileUrl}}):e.defaultImg?a("img",{staticClass:"avatar",class:e.cssClass,style:e.cssStyle,attrs:{src:e.defaultImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])},staticRenderFns:[]};var l=a("VU/8")(o,i,!1,function(e){a("S3LB")},"data-v-5dd70ca3",null);t.a=l.exports}});